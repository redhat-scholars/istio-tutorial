<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Observability :: Istio Tutorial Docs</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/istio-tutorial/istio-tutorial/1.9.x/3monitoring-tracing.html">
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/istio-tutorial">Istio Tutorial Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="istio-tutorial" data-version="1.9.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction to Istio Tutorial</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="1setup.html">1. Setup &amp; Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1setup.html#prerequisites">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1setup.html#istioinstallation">Install Istio</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="2deploy-microservices.html">2. Deploy Microservices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2deploy-microservices.html#deploycustomer">Deploy the Customer Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2deploy-microservices.html#configureingress">Configure Ingress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2deploy-microservices.html#_validate_ingress">Validate Ingress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2deploy-microservices.html#deploypreference">Deploy the Preference Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2deploy-microservices.html#deployrecommendation">Deploy the Recommendation Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2deploy-microservices.html#redeployingcode">Updating &amp; Redeploying Code</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="3monitoring-tracing.html">3. Observability</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#simulatetraffic">Simulate Traffic in the Mesh Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#monitoring">Grafana</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_obtaining_the_grafana_url">Obtaining the Grafana URL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-text"><a href="/istio-tutorial/1.9.x/3monitoring-tracing.html#_viewing_istio_dashboards_in_grafana" class="page">Viewing Istio Dashboards in Grafana
</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#prometheus">Prometheus</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_accessing_the_prometheus_dashboard">Accessing the Prometheus Dashboard</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#custommetrics">Querying Prometheus</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#containermemory">Querying Container Memory Usage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#tracing">Jaeger</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_accessing_the_jaeger_dashboard">Accessing the Jaeger Dashboard</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_viewing_traces">Viewing Traces</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_viewing_detailed_trace_information">Viewing Detailed Trace Information</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="3kiali.html">Kiali</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#howkiali">How Kiali Work</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#updatekiali">Update Kiali</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#generatingdata">Generating Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#servicegraph">Service Graph</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#servicelistening">Service Listening</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#istioconf">Istio Config</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#distributedtracing">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="3kiali.html#cleanup">Uninstall Kiali</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">4. Traffic Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="4simple-routerules.html">Simple Routing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="4simple-routerules.html#deployrecommendationv2">Deploy Recommendation V2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="4simple-routerules.html#istiorouting">Changing Istio Routings</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4simple-routerules.html#alltorecommendationv2">All Users To Recommendation V2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4simple-routerules.html#alltorecommendationv1">All Users To Recommendation V1</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4simple-routerules.html#alltorecommendationv1v2">All Users To Recommendation V1 and V2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4simple-routerules.html#canarydeploymentrecommendation">Canary Deployment Between v1 And v2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="4advanced-routerules.html">Advanced Routing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="4advanced-routerules.html#canarydeploymentuseragent">Canary Deployment based on user-agent</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4advanced-routerules.html#alltorecommendationv1">All Users To Recommendation V1</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4advanced-routerules.html#safaritov2">All Safari Users To Recommendation V2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="4advanced-routerules.html#mobiletov2">All Mobile Users To Recommendation V2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="4advanced-routerules.html#mirroringtraffic">Mirroring Traffic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="4advanced-routerules.html#loadbalancer">Load Balancer</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="5circuit-breaker.html">5. Service Resiliency</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5circuit-breaker.html#retry">Retry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5circuit-breaker.html#timeout">Timeout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="5circuit-breaker.html#failfast">Fail Fast</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="5circuit-breaker.html#nocircuitbreaker">No Circuit Breaker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="5circuit-breaker.html#circuitbreaker">Circuit Breaker</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="6fault-injection.html">6. Chaos Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="6fault-injection.html#503error">HTTP 503 Error</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="6fault-injection.html#delay">Delay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">7. Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="8egress.html">Egress</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8egress.html#createrecommendationv3">Create Recommendation V3</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8egress.html#istioegress">Istio-ize Egress</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="8acl.html">Access Control</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8acl.html#authpolicies">Authorization Policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="8mTLS.html">Mutual TLS and Istio</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8mTLS.html#testingtls">Testing mTLS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="8jwt.html">End-user authentication with JWT</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8jwt.html#enablingauthentication">Enabling end-user authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8jwt.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="8rbac.html">Istio Role Based Access Control (RBAC)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8rbac.html#authorization-jwt">Authorization and JWT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8rbac.html#final-notes">Final Notes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="8rbac.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#8tips.adoc">10. Tips And Tricks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="advanced/index.html">Advanced Istio Tutorial</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="advanced/virtualization.html">Service Virtualization and Istio</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/virtualization.html#deploypreferencev2">Deploy Preference V2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/virtualization.html#servicevirtualization">Adding Service Virtualization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/virtualization.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="advanced/diferencia.html">Diferencia and Detecting Regressions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/diferencia.html#what-is-diferencia">What is Diferencia?</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/diferencia.html#master-candidate">Setting Master Candidate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/diferencia.html#deploying-diferencia">Deploying Diferencia</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/diferencia.html#shadowing-traffic">Shadowing Traffic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/diferencia.html#noise-detection">Noise Detection</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/diferencia.html#cleanup">Clean up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="advanced/promotion.html">Istio for Promoting Services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/promotion.html#what-is-promotion">What is Promotion?</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/promotion.html#deploy-recommendation-v3">Deploy Recommendation V3</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/promotion.html#feature-graduation]">Feature Graduation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/promotion.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="advanced/zero-downtime-database.html">Zero Downtime Migration with Database</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Starting the Migration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="advanced/zero-downtime-database.html#recommendationv4">Deploy Recommendation V4</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="advanced/zero-downtime-database.html#recommendationv5">Deploy Recommendation V5</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="advanced/zero-downtime-database.html#recommendationv6">Deploy Recommendation V6</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="advanced/zero-downtime-database.html#recommendationv7">Deploy Recommendation V7</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/zero-downtime-database.html#finalstep">Final Step</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/zero-downtime-database.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="advanced/cube.html">Dark Launch Automatic Test</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/cube.html#preparation">Preparation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/cube.html#explanation">Explanation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/cube.html#code">Source Code</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="advanced/cube.html#restore">Restore Environment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Istio Tutorial</a></li>
    <li><a href="3monitoring-tracing.html">3. Observability</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/istio-tutorial/edit/master/documentation/modules/ROOT/pages/3monitoring-tracing.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Observability</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Istio includes observability features that are powered by Prometheus and Grafana. Prometheus is an open-source monitoring and alerting toolkit that is used to collect metrics from Istio and the services running within the mesh. Grafana is an open-source visualization tool that can be used to create dashboards and charts based on the data collected by Prometheus. Together, these tools provide Istio users with powerful observability capabilities, allowing them to monitor the performance of their applications and troubleshoot any issues that may arise.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simulatetraffic"><a class="anchor" href="#simulatetraffic"></a>Simulate Traffic in the Mesh Network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Viewing the Grafana and Prometheus dashboards won&#8217;t be interesting unless there&#8217;s traffic flowing through the services that were deployed in the <a href="2deploy-microservices.html" class="page">Deploy Microservices</a> section of this tutorial.</p>
</div>
<div class="paragraph">
<p>Execute the following command to produce some load on the services:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./scripts/run.sh $GATEWAY_URL/customer</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>GATEWAY_URL</code> can be obtained by returning to the <a href="#2deploy-microservices.html#_validate_ingress" class="page unresolved">Validate Ingress</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Leave this command running while exploring the Grafana, Prometheus, and Jaeger dashboards.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring"><a class="anchor" href="#monitoring"></a>Monitoring with Grafana</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grafana is an open-source tool for creating, exploring, and sharing dashboards for monitoring your infrastructure and applications. It allows you to query and visualize data from multiple sources, including Prometheus, Elasticsearch, and InfluxDB. Grafana is often used in combination with other monitoring tools to provide comprehensive visibility into the health and performance of your systems. Grafana was automatically deployed by the Istio installation.</p>
</div>
<div class="sect2">
<h3 id="_obtaining_the_grafana_url"><a class="anchor" href="#_obtaining_the_grafana_url"></a>Obtaining the Grafana URL</h3>
<div class="paragraph">
<p>The first step to using Grafana is obtaining the URL to access the web-based Grafana dashboard:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset1_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_minikube">
<div class="paragraph">
<p>In a new terminal window run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl dashboard grafana</code></pre>
</div>
</div>
<div class="paragraph">
<p>Navigate to <code>dashboard/db/istio-mesh-dashboard</code>.</p>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_openshift">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login to your OpenShift Web Console.</p>
</li>
<li>
<p>Select the <strong>Administrator</strong> perspective from the side-menu.</p>
</li>
<li>
<p>Expand <strong>Networking</strong> and select <strong>Routes</strong> in the side-menu.</p>
</li>
<li>
<p>Verify that <code>istio-system</code> is selected in the <strong>Project</strong> dropdown. The Grafana route will be displayed in the Routes list.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/grafana-openshift-route.png" alt="OpenShift Routes in the Istio System Namespace"></span></p>
</div>
</li>
<li>
<p>Click the URL in the <strong>Location</strong> column for the <code>grafana</code> list item. This will open the Grafana dashboard in another browser window/tab.</p>
</li>
<li>
<p>You will be prompted to login using your OpenShift account. Click the <strong>Log in with OpenShift</strong> button and follow the onscreen prompts to access the Grafana dashboard.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/grafana-openshift-login.png" alt="Grafana OpenShift SSO Page"></span></p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_istio_dashboards_in_grafana"><a class="anchor" href="#_viewing_istio_dashboards_in_grafana"></a>Viewing Istio Dashboards in Grafana</h3>
<div class="paragraph">
<p>With access to Grafana it&#8217;s possible to view metrics dashboards that have been  pre-configured by Istio:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <code>/dashboards</code> page. It should look similar to the image below.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/grafana-dashboards.png" alt="Grafana Dashboards List"></span></p>
</div>
</li>
<li>
<p>Select the <strong>Istio Mesh Dashboard</strong>. It should display a metrics dashboard.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/grafana-istio-mesh-metrics.png" alt="Grafana Istio Mesh Dashboard"></span></p>
</div>
</li>
<li>
<p>Click the <code>preference-v1.tutorial</code> under the <strong>Workload</strong> column to view granular metrics for the preference service.</p>
</li>
<li>
<p>Expand the <strong>Outbound Services</strong> section. This provides information related to outgoing traffic. For example, it&#8217;s possible to see that the preference service sends data to Jaeger (<code>jaeger-collector.istio-system.svc.cluster.local</code>) and the recommendation service (<code>recommendation.tutorial.svc.cluster.local</code>).
<span class="image"><img src="_images/grafana-preference-outbound-metrics.png" alt="Grafana Istio Mesh Dashboard / Preference"></span></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prometheus"><a class="anchor" href="#prometheus"></a>Prometheus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prometheus is an open-source metrics collector that is commonly used in cloud-native environments. It collects data from monitored targets by scraping exposed metrics HTTP endpoints on these targets (a <strong>pull-based</strong> model), and stores the collected data in a time-series database. Prometheus also includes a powerful query language and a built-in graphing and alerting functionality, making it easy to analyze and visualize the collected data, and to set up alerts based on this data. Prometheus is often used in conjunction with other tools, such as Grafana, to provide a complete monitoring and observability solution for cloud-native applications.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/prometheus-architecture.png" alt="Prometheus Architecture"></span></p>
</div>
<div class="sect2">
<h3 id="_accessing_the_prometheus_dashboard"><a class="anchor" href="#_accessing_the_prometheus_dashboard"></a>Accessing the Prometheus Dashboard</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset2_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_minikube">
<div class="paragraph">
<p>In a new terminal window run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl dashboard prometheus</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_openshift">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can obtain the Prometheus dashboard URL using the same steps you used to obtain the Grafana URL. The below instructions are provided to demonstrate an alternative CLI-based approach.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following command:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get route prometheus -n istio-system</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the URL printed in the <strong>HOST/PORT</strong> column from the output of the previous command.</p>
</li>
<li>
<p>Paste this into your web browser&#8217;s address bar.</p>
</li>
<li>
<p>You will be prompted to login using your OpenShift account. Click the <strong>Log in with OpenShift</strong> button and follow the onscreen prompts to access the Prometheus dashboard.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Prometheus dashboard should now be visible in your browser.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/prometheus-dashboard.png" alt="Prometheus Dashboard"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="custommetrics"><a class="anchor" href="#custommetrics"></a>Querying Prometheus</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Prometheus dashboard, paste the following query into the input area.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istio_requests_total{destination_service="recommendation.tutorial.svc.cluster.local"}</code></pre>
</div>
</div>
</li>
<li>
<p>Click the <strong>Execute</strong> button.</p>
</li>
<li>
<p>Change the graph from "line" to "stacked" mode using the toggle.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/prometheus-query.png" alt="Prometheus Query Results"></span></p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may have to refresh the browser for the Prometheus graph to update. And you may wish to make the interval 5m (5 minutes) using the plus/minus icons above the graph.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that two series are displayed. This is because the Envoy proxy sidecar in the preference service Pod reports the outbound request, and the Envoy proxy sidecar in the recommendation service Pod also reports the inbound. This can be confirmed by correlating the <strong>app</strong> and <strong>instance</strong> labels of each series to the running preference and recommendation Pods using the following command:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get pod -n tutorial -o wide</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Pod IP addresses displayed in this tutorial will differ from what you see in your environment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the screenshot above shows a series where <code>app=preference</code> and <code>instance=10.217.1.2</code>. This correlates with the preference Pod shown in the output of <code>kubectl get pod -n tutorial -o wide</code>:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                 READY   STATUS    RESTARTS      AGE   IP             NODE                 NOMINATED NODE   READINESS GATES
customer-5f5d9f8767-dmc4f            2/2     Running   0             23h   10.217.0.157   crc-5nvrm-master-0   &lt;none&gt;           &lt;none&gt;
preference-v1-5d474ff7bd-lf9gt       2/2     Running   1 (19h ago)   19h   10.217.1.2     crc-5nvrm-master-0   &lt;none&gt;           &lt;none&gt;
recommendation-v1-6c75fc9857-d4npl   2/2     Running   0             19h   10.217.1.25    crc-5nvrm-master-0   &lt;none&gt;           &lt;none&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="containermemory"><a class="anchor" href="#containermemory"></a>Querying Container Memory Usage</h3>
<div class="paragraph">
<p>Istio exposes the memory usage of the Envoy container to Prometheus.</p>
</div>
<div class="paragraph">
<p>In the Prometheus dashboard, execute the following query:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istio_agent_process_resident_memory_bytes{kubernetes_namespace="tutorial",app=~"customer|preference|recommendation"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Switch the graph to stacked mode. The RSS memory usage of the Envoy sidecar processes is displayed:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/prometheus-memory.png" alt="Prometheus memory"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tracing"><a class="anchor" href="#tracing"></a>Tracing with Jaeger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Distributed Tracing involves propagating the tracing context from service to service, usually done by sending certain incoming HTTP headers downstream to outbound requests. For services embedding a <a href="http://opentracing.io/">OpenTracing</a> framework instrumentations such as <a href="https://github.com/opentracing-contrib/java-spring-cloud">opentracing-spring-cloud</a>, this might be transparent. For services that are not embedding OpenTracing libraries, this context propagation needs to be done manually.</p>
</div>
<div class="paragraph">
<p>As OpenTracing is "just" an instrumentation library, a concrete tracer is required in order to actually capture the tracing data and report it to a remote server. Our <code>customer</code> and <code>preference</code> services ship with <a href="http://jaegertracing.io/">Jaeger</a> as the concrete tracer. the Istio platform automatically sends collected tracing data to Jaeger, so that we are able to see a trace involving all three services, even if our <code>recommendation</code> service is not aware of OpenTracing or Jaeger at all.</p>
</div>
<div class="paragraph">
<p>Our <code>customer</code> and <code>preference</code> services are using the <a href="https://github.com/jaegertracing/jaeger-client-java/tree/master/jaeger-tracerresolver"><code>TracerResolver</code></a> facility from OpenTracing, so that the concrete tracer can be loaded automatically without our code having a hard dependency on Jaeger. Given that the Jaeger tracer can be configured via environment variables, we don&#8217;t need to do anything in order to get a properly configured Jaeger tracer ready and registered with OpenTracing. That said, there are cases where it&#8217;s appropriate to manually configure a tracer. Refer to the Jaeger documentation for more information on how to do that.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s open the Jaeger console, select <code>customer</code> from the list of services and click <code>Find Traces</code></p>
</div>
<div class="sect2">
<h3 id="_accessing_the_jaeger_dashboard"><a class="anchor" href="#_accessing_the_jaeger_dashboard"></a>Accessing the Jaeger Dashboard</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset3_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_minikube">
<div class="paragraph">
<p>In a new terminal window run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl dashboard jaeger</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_openshift">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login to your OpenShift Web Console.</p>
</li>
<li>
<p>Select the <strong>Administrator</strong> perspective from the side-menu.</p>
</li>
<li>
<p>Expand <strong>Networking</strong> and select <strong>Routes</strong> in the side-menu.</p>
</li>
<li>
<p>Verify that <code>istio-system</code> is selected in the <strong>Project</strong> dropdown. The Jaeger route will be displayed in the Routes list.</p>
</li>
<li>
<p>Click the URL in the <strong>Location</strong> column for the <code>jaeger</code> list item. This will open the Jaeger dashboard in another browser window/tab.</p>
</li>
<li>
<p>You will be prompted to login using your OpenShift account. Click the <strong>Log in with OpenShift</strong> button and follow the onscreen prompts to access the Jaeger dashboard.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Jaeger dashboard will look similar to the following screenshot.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/jaegerUI.png" alt="Trace as seen in Jaeger"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_traces"><a class="anchor" href="#_viewing_traces"></a>Viewing Traces</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jaeger&#8217;s traces are based on traffic in the Istio mesh network. Make sure to follow the instructions in the <a href="#">Simulate Traffic in the Mesh Network</a> section before proceeding.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perform a search to view traces:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <strong>Search</strong> screen from the header in the Jaeger dashboard.</p>
</li>
<li>
<p>Choose <code>istio-ingressgateway.istio-system</code> in the <strong>Service</strong> dropdown from the <strong>Search</strong> pane.</p>
</li>
<li>
<p>Leave the other inputs at their default values and click <strong>Find Traces</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A plot of traces corresponding to HTTP requests is displayed, along with a list of those items from the plot.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/jaeger-search.png" alt="Jaeger Search Results"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_detailed_trace_information"><a class="anchor" href="#_viewing_detailed_trace_information"></a>Viewing Detailed Trace Information</h3>
<div class="paragraph">
<p>View more trace details:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the first item returned in the list of traces. A more detailed view of the trace is displayed.</p>
</li>
<li>
<p>Select the <code>Trace Timeline</code> view from the dropdown in the top-right.</p>
</li>
<li>
<p>Expand the following trace segments by clicking their names:</p>
<div class="ulist">
<ul>
<li>
<p><code>istio-ingressgateway.istio-system</code></p>
</li>
<li>
<p><code>customer.tutorial</code></p>
</li>
<li>
<p><code>customer</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>These segments represent different stages of the request flow through the mesh and microservices in our application architecture.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/jaeger-trace-details.png" alt="Jaeger Trace Details"></span></p>
</div>
<div class="paragraph">
<p>The first segment represents when the request entered our mesh via the <code>istio-ingressgateway</code> in the <code>istio-system</code> namespace. Next, the request was routed to the <code>customer</code> service in the <code>tutorial</code> namespace. You can corelate both of the IP addresses listed in these segments with the running Pods in each namespace. The third segment represents the processing of the request in the <code>getCustomer</code> method of the customer Java application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_analysing_request_processing_times"><a class="anchor" href="#_analysing_request_processing_times"></a>Analysing Request Processing Times</h3>
<div class="paragraph">
<p>If there&#8217;s a slowdown in request processing, the <strong>Trace Flamegraph</strong> could be used to identify candidates for closer inspection during a root cause analysis.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <code>Trace Flamegraph</code> from the top-right.</p>
</li>
<li>
<p>Set the view toggle to <strong>Table</strong> mode.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/jaeger-flamegraph.png" alt="Jaeger Flamegraph"></span></p>
</div>
<div class="paragraph">
<p>The segments are ordered from longest to shortest self processing time, by default. For the trace shown in the screenshot above, it&#8217;s clear that there was a minor network delay at the recommendation service. Most of the network traffic segments show durations between 57ms and 74ms, but the recommendation segment is 1.63ms.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
